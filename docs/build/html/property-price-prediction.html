

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Property Price Prediction &mdash; algotrading 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sentiment analysis" href="sentiment-analysis.html" />
    <link rel="prev" title="Bankruptcy prediction" href="bankruptcy-prediction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> algotrading
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="how-to-use-this.html">How to use this</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Part 1: Intro to Algo Trading</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-science-basics.html">Data science basics</a></li>
</ul>
<p class="caption"><span class="caption-text">Part 2: Core trading strategies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="technical-analysis.html">Techinical analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamental-analysis.html">Fundamental analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="evaluation-metrics.html">Evaluation metrics</a></li>
</ul>
<p class="caption"><span class="caption-text">Part 3: Machine Learning</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bankruptcy-prediction.html">Bankruptcy prediction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Property Price Prediction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro-to-macroeconomic-analysis">Intro to macroeconomic analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#macroeconomic-indicators-in-hong-kong">Macroeconomic indicators in Hong Kong</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#univariate-analysis">Univariate analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bivariate-analysis">Bivariate analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-hong-kong-real-estate-market">The Hong Kong real estate market</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-pre-processing">Data pre-processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#economic-indicator-analysis">Economic indicator analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transaction-record-analysis">Transaction record analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#property-price-prediction-with-machine-learning">Property price prediction with machine learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#train-test-split">Train-test split</a></li>
<li class="toctree-l3"><a class="reference internal" href="#log-transformation">Log transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#training-the-model">Training the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#evaluate-accuracy">Evaluate accuracy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sentiment-analysis.html">Sentiment analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="acknowledgement.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="about-the-author.html">About the author</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">algotrading</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Property Price Prediction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/property-price-prediction.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="property-price-prediction">
<h1>Property Price Prediction<a class="headerlink" href="#property-price-prediction" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, you will learn:</p>
<ul class="simple">
<li><p>The basics in macroeconomic analysis</p></li>
<li><p>The ways of analyzing macroeconomic indicators</p></li>
<li><p>The ways of analyzing real estate market data</p></li>
<li><p>How to build a property price prediction model</p></li>
</ul>
<div class="section" id="intro-to-macroeconomic-analysis">
<h2>Intro to macroeconomic analysis<a class="headerlink" href="#intro-to-macroeconomic-analysis" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">As we have discussed in the first tutorial, macroeconomic analysis is a way of
investigating the macroeconomic indicators that influence the stock market.</div>
</div>
<div class="line-block">
<div class="line">In this module, we will first analyze the macroeconomic indicators and explore how
the indicators affect the stock prices in Hong Kong.</div>
</div>
<div class="line-block">
<div class="line">Then, we will specifically analyze the Hong Kong real estate market, as we believe
that it is one of the most important macroeconomic indicator that can reflect the
Hong Kong’s economy.</div>
</div>
<div class="line-block">
<div class="line">In addition, we will build a property price prediction model to predict the house price
of Hong Kong.</div>
</div>
</div>
<div class="section" id="macroeconomic-indicators-in-hong-kong">
<h2>Macroeconomic indicators in Hong Kong<a class="headerlink" href="#macroeconomic-indicators-in-hong-kong" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Before proceeding, first import some necessary libraries needed for this module.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">LabelEncoder</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">After importing the libraries, let’s have a look at the data. The data contains 8
different macroeconomic indicators collected from 2016 to 2020.</div>
</div>
<div class="line-block">
<div class="line">Use <code class="code docutils literal notranslate"><span class="pre">df.info()</span></code> to print information of all columns.</div>
</div>
<div class="figure align-center" id="id1">
<img alt="&quot;Macroeconomic data.&quot;" src="../images/macroeconomic_data.png" style="width: 400px;" />
<p class="caption"><span class="caption-text">The column information of macroeconomic data.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="univariate-analysis">
<h3>Univariate analysis<a class="headerlink" href="#univariate-analysis" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">In univariate analysis, use <code class="code docutils literal notranslate"><span class="pre">pandas.Dataframe.describe()</span></code> to examine the
distribution of the numerical features. It returns the statistical summary such as mean,
standard deviation, min, and max of a data frame.</div>
</div>
<div class="line-block">
<div class="line">For a better understanding of the statistics summary, use <code class="code docutils literal notranslate"><span class="pre">seaborn.distplot()</span></code>
to visualise the results with histograms.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statistical summary</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">],</span> <span class="n">axlabel</span><span class="o">=</span><span class="n">feature_name</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="bivariate-analysis">
<h3>Bivariate analysis<a class="headerlink" href="#bivariate-analysis" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">In bivariate analysis, we are going to study the correlations between
a macroeconomic indicator and the Hang Seng Index.
Use <code class="code docutils literal notranslate"><span class="pre">matplotlib.pyplot.scatter()</span></code> and <code class="code docutils literal notranslate"><span class="pre">seaborn.regplot()</span></code> to
visualize the relationship between two features.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hsi&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hsi&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center" id="id2">
<img alt="&quot;Scatter graph with regline.&quot;" src="../images/scatter_graph_regline.png" style="width: 400px;" />
<p class="caption"><span class="caption-text">An example of a scatter plot with a regression line.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">Then, use <code class="code docutils literal notranslate"><span class="pre">pandas.Dataframe.corr()</span></code> and <code class="code docutils literal notranslate"><span class="pre">seaborn.heatmap()</span></code> to compute
a pairwise correlation of features and visualize the correlation matrix.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;hsi&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">hm</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">11</span><span class="p">},</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">cols</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">cols</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-center" id="id3">
<img alt="&quot;Heatmap - macroeconomic indicator.&quot;" src="../images/heatmap_macro_indicator.png" style="width: 620px;" />
<p class="caption"><span class="caption-text">Heatmap - macroeconomic indicators of Hong Kong.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">According to the above figure, we can see that GDP, house price, population, imports,
year, total exports, and composite consumer price index are positively correlated to the
Hang Seng index, while both seasonally adjusted unemployment rate and not seasonally
adjusted unemployment rate are negatively correlated to the Hang Seng index.</div>
</div>
</div>
</div>
<div class="section" id="the-hong-kong-real-estate-market">
<h2>The Hong Kong real estate market<a class="headerlink" href="#the-hong-kong-real-estate-market" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">As shown above, the house price in Hong Kong has a strong positive correlation with the
Hang Seng Index. In fact, the properties and construction sector accounts for over 10%
of weighting in the Hang Seng Index (Hang Seng Indexes Company Limited, 2020), and thus
the real estate market data is a source of volatility in the Hong Kong stock market.</div>
</div>
<div class="line-block">
<div class="line">While Hong Kong’s real estate market is a constant topic of discussion, it will be worth
analyzing the Hong Kong real estate market data. Using the same data analysis
technique used for the above analysis, we will now analyze Hong Kong residential
market transaction records.</div>
</div>
<div class="section" id="data-pre-processing">
<h3>Data pre-processing<a class="headerlink" href="#data-pre-processing" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Before analyzing the transaction records:</div>
</div>
<p>1. Derive some useful features from existing features.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add new features</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RegDate&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RegDate&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
<p>2. Drop unmeaningful features and features with too many missing values</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Drop unnecessary columns</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">feature_name</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>3. Handle missing values by replacing NAN with a mean value of a feature</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Handling missinig values</span>
<span class="c1"># Fill with mean</span>
<span class="n">feature_name_mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">feature_name_mean</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Label encode categorical features</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">le</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">processed_df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">processed_df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">processed_df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="economic-indicator-analysis">
<h3>Economic indicator analysis<a class="headerlink" href="#economic-indicator-analysis" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">In economic indicator analysis, we will explore how the macroeconomic indicators affect the
monthly average house price per saleable area in Hong Kong.</div>
</div>
<div class="line-block">
<div class="line">The transaction records from Centaline Property will be used for this analysis.</div>
</div>
<div class="figure align-center" id="id4">
<img alt="&quot;Transaction records - Centaline Property&quot;" src="../images/transaction_record_centaline.png" style="width: 700px;" />
<p class="caption"><span class="caption-text">The data structure of transaction record (Centaline Property).</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">Before analyzing the data, calculate the monthly average house price per saleable area.
Then, join the data with economic indicators by year and month.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate the monthly average house price</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;UnitPricePerSaleableArea&#39;</span><span class="p">:</span> <span class="s1">&#39;AveragePricePerSaleableArea&#39;</span><span class="p">})</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Using the bivariate analysis method we learned, a pairwise correlation of features
is computed and visualized. The result shows that population, GDP, composite consumer price index,
population, year, imports, month, and total exports are positively correlated to the
monthly average house price per saleable area in Hong Kong, while both unemployment
rates are not correlated to the monthly average house price per saleable area in Hong Kong.</div>
</div>
<div class="figure align-center" id="id5">
<img alt="&quot;Heatmap - economic indicator analysis&quot;" src="../images/corr_economic_indicator_analysis.png" style="width: 620px;" />
<p class="caption"><span class="caption-text">Heatmap - economic indicators analysis.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="transaction-record-analysis">
<h3>Transaction record analysis<a class="headerlink" href="#transaction-record-analysis" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">In transaction record analysis, we will examine the relationship between features describing
the house and the individual housing prices of Hong Kong.</div>
</div>
<div class="line-block">
<div class="line">The transaction records from Midland Realty will be used for this analysis.</div>
</div>
<div class="figure align-center" id="id6">
<img alt="&quot;Transaction records - Midland Realty - Part 1&quot;" src="../images/transaction_record_midland1.png" style="width: 650px;" />
<p class="caption"><span class="caption-text">The data structure of transaction record (Midland Realty) - Part 1.</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id7">
<img alt="&quot;Transaction records - Midland Realty - Part 2&quot;" src="../images/transaction_record_midland2.png" style="width: 650px;" />
<p class="caption"><span class="caption-text">The data structure of transaction record (Midland Realty) - Part 2.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">In univariate analysis, the distribution of Hong Kong’s house price is examined.
The housing price of Hong Kong has a mean of 9 million HKD and a standard deviation
of 13 million HKD. The skewness and kurtosis were 26.9 and 1526.4 respectively,
showing that the housing price of Hong Kong is skewed positively to a very high
degree.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Distribution</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Skewness and kurtosis</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skewness: &quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kurtosis: &quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">kurt</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#output:</span>

<span class="n">count</span>    <span class="mf">1.664090e+05</span>
<span class="n">mean</span>     <span class="mf">9.133268e+06</span>
<span class="n">std</span>      <span class="mf">1.310856e+07</span>
<span class="nb">min</span>      <span class="mf">5.500000e+05</span>
<span class="mi">25</span><span class="o">%</span>      <span class="mf">5.200000e+06</span>
<span class="mi">50</span><span class="o">%</span>      <span class="mf">6.830000e+06</span>
<span class="mi">75</span><span class="o">%</span>      <span class="mf">9.500000e+06</span>
<span class="nb">max</span>      <span class="mf">1.399000e+09</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">Skewness</span><span class="p">:</span>  <span class="mf">26.927207752922435</span>
<span class="n">Kurtosis</span><span class="p">:</span>  <span class="mf">1526.4066673335874</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">In order to get a better result for the bivariate analysis, outliers are
removed by using standard deviation.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate mean and standard deviation</span>
<span class="n">data_mean</span><span class="p">,</span> <span class="n">data_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">])</span>

<span class="c1"># Calculate upper boundary</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">data_mean</span> <span class="o">+</span> <span class="n">data_std</span> <span class="o">*</span> <span class="mi">3</span>

<span class="c1"># Remove outliers</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">upper</span><span class="p">]</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">In bivariate analysis, the correlation coefficient between the features describing
the house and the house price is computed. 7 features with the highest correlation
is selected and shown below.</div>
</div>
<div class="figure align-center" id="id8">
<img alt="&quot;Heatmap - transaction data analysis&quot;" src="../images/corr_transaction_data.png" style="width: 500px;" />
<p class="caption"><span class="caption-text">Heatmap - transaction data analysis.</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">According to the above figure, the housing price in Hong Kong has (1) a strong positive
correlation with saleable area; (2) a moderate positive correlation with last
transaction price; (3) a moderate positive correlation with gross area; (4) a moderate
positive correlation with number of bedrooms; (5) a weak positive correlation with
floor; (6) a weak negative correlation with region; and (7) a weak negative correlation
with building age.</div>
</div>
<div class="line-block">
<div class="line">The full implementation of the economic indicator analysis and transaction data analysis
could be found in <code class="code docutils literal notranslate"><span class="pre">code/macroeconomic-analysis/</span></code> in the repository.</div>
</div>
</div>
</div>
<div class="section" id="property-price-prediction-with-machine-learning">
<h2>Property price prediction with machine learning<a class="headerlink" href="#property-price-prediction-with-machine-learning" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Based on the transaction data analysis, let’s build property price prediction models.</div>
</div>
<div class="section" id="train-test-split">
<h3>Train-test split<a class="headerlink" href="#train-test-split" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Use <code class="code docutils literal notranslate"><span class="pre">sklearn.model_selection.train_test_split()</span></code> to split the data with the ratio
of 8:2. The input variables are the top 7 features selected from the analysis, and
the output feature is the house price.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feat_col</span> <span class="o">=</span> <span class="p">[</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="p">]</span>
<span class="n">x_df</span><span class="p">,</span> <span class="n">y_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feat_col</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>

<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x_df</span><span class="p">,</span> <span class="n">y_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RAND_SEED</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="log-transformation">
<h3>Log transformation<a class="headerlink" href="#log-transformation" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Before training the model, transform <code class="code docutils literal notranslate"><span class="pre">y_train</span></code> using log function to normalise the highly
skewed price data. In this way, the dynamic range of Hong Kong’s property price can be reduced.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">log_y_train</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="training-the-model">
<h3>Training the model<a class="headerlink" href="#training-the-model" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">In total, 4 different types of predictive models will be built:</div>
</div>
<ol class="arabic simple">
<li><p>XGBoost</p></li>
<li><p>Lasso</p></li>
<li><p>Random Forest</p></li>
<li><p>Linear Regression</p></li>
</ol>
<div class="line-block">
<div class="line">Train the models with <code class="code docutils literal notranslate"><span class="pre">x_train</span></code> and <code class="code docutils literal notranslate"><span class="pre">y_train</span></code>, and use the
models to make the predictions.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>

<span class="c1"># XGBoost</span>
<span class="n">model_xgb</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">objective</span> <span class="o">=</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">,</span>
                      <span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                      <span class="n">random_state</span><span class="o">=</span><span class="n">RAND_SEED</span><span class="p">,</span> <span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">model_xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">log_y_train</span><span class="p">)</span>
<span class="n">xgb_train_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">model_xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">))</span>
<span class="n">xgb_test_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">model_xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="evaluate-accuracy">
<h3>Evaluate accuracy<a class="headerlink" href="#evaluate-accuracy" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Then, evaluate the performance of each model by root mean square log error (RMSLE).
The reason why RMSLE is used is because the price values are too big, and RMSLE prevents
penalising large differences between actual and predicted prices.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">mean_squared_log_error</span>

<span class="k">def</span> <span class="nf">rmsle</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_log_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#output:</span>

    <span class="n">XGBoost</span> <span class="n">RMSLE</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>  <span class="mf">0.1626671056150446</span>
    <span class="n">XGBoost</span> <span class="n">RMSLE</span><span class="p">(</span><span class="n">test</span><span class="p">):</span>  <span class="mf">0.16849945199484243</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">The train model RMSLE and the test model RMSLE are 0.1627 and 0.1685 respectively.
XGBoost uses a more accurate implementation of gradient boosting algorithm and
optimised regularisation, and hence, it gives a better result than other models.</div>
</div>
<div class="line-block">
<div class="line">However, in this case, the result shows that the model is slightly overfitting the train data.
The below figure shows the graph of actual and predicted property price for XGBoost.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">xgb_test_pred</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Actual Y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted Y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-center" id="id9">
<img alt="&quot;The prediction graph for XGBoost.&quot;" src="../images/prediction_graph_xgb.png" style="width: 300px;" />
<p class="caption"><span class="caption-text">The graph of actual and predicted house price for XGBoost.</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<div class="line-block">
<div class="line">All investments entail inherent risk. This repository seeks to solely educate
people on methodologies to build and evaluate algorithmic trading strategies.
All final investment decisions are yours and as a result you could make or lose money.</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="sentiment-analysis.html" class="btn btn-neutral float-right" title="Sentiment analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="bankruptcy-prediction.html" class="btn btn-neutral float-left" title="Bankruptcy prediction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Angel Woo.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>