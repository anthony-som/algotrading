

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sentiment analysis &mdash; algotrading 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multi-feature trading strategy" href="multi-feature-strategy.html" />
    <link rel="prev" title="Property price prediction" href="property-price-prediction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> algotrading
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="how-to-use-this.html">How to use this</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Part 1: Intro to Algo Trading</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-science-basics.html">Data science basics</a></li>
</ul>
<p class="caption"><span class="caption-text">Part 2: Core trading strategies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="technical-analysis.html">Technical analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamental-analysis.html">Fundamental analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="evaluation-metrics.html">Evaluation metrics</a></li>
</ul>
<p class="caption"><span class="caption-text">Bonus: Julia for algo trading</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction-to-julia.html">Introduction to Julia</a></li>
<li class="toctree-l1"><a class="reference internal" href="julia-data-science-basics.html">Data science basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="julia-technical-analysis.html">Buliding a strategy</a></li>
</ul>
<p class="caption"><span class="caption-text">Part 3: Machine Learning</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bankruptcy-prediction.html">Bankruptcy prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="property-price-prediction.html">Property price prediction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sentiment analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro-to-sentiment-analysis">Intro to sentiment analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#collection-of-tweets">Collection of tweets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#timeline-tweets">Timeline tweets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hashtag-cashtag-tweets">Hashtag/Cashtag tweets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stream-tweets">Stream tweets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#collect-financial-headlines">Collect financial headlines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#us-news-headlines">US news headlines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hk-news-headlines">HK news headlines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#vader-sentiment-prediction">VADER sentiment prediction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="multi-feature-strategy.html">Multi-feature trading strategy</a></li>
</ul>
<p class="caption"><span class="caption-text">Bonus: Trade execution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction-to-paper-trading.html">Introduction to Paper Trading</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="acknowledgement.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="about-the-author.html">About the author</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">algotrading</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Sentiment analysis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/sentiment-analysis.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sentiment-analysis">
<h1>Sentiment analysis<a class="headerlink" href="#sentiment-analysis" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, you will learn:</p>
<ul class="simple">
<li><p>The basics of sentiment analysis</p></li>
<li><p>How to collect tweets</p></li>
<li><p>How to collect financial news headlines</p></li>
<li><p>What are the common ways of analysing sentiment</p></li>
<li><p>How to measure the accuracy of the sentiment prediction</p></li>
</ul>
<div class="section" id="intro-to-sentiment-analysis">
<h2>Intro to sentiment analysis<a class="headerlink" href="#intro-to-sentiment-analysis" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">As we have discussed in the Introduction part, sentiment analysis is a natural language processing technique that is used to
determine whether a statement contains positive, negative or neutral sentiment.
In this tutorial, we aim to analyse the daily sentiment of a stock with the use of relevant news headlines and tweets,
and thus to find out the market sentiment.</div>
</div>
</div>
<div class="section" id="collection-of-tweets">
<h2>Collection of tweets<a class="headerlink" href="#collection-of-tweets" title="Permalink to this headline">¶</a></h2>
<p><strong>Apply for developer account from Twitter use Tweepy</strong></p>
<div class="line-block">
<div class="line">1. Click and apply for a developer account through this link: <a class="reference external" href="https://developer.twitter.com/en/apply-for-access">https://developer.twitter.com/en/apply-for-access</a></div>
<div class="line">2. Create a new project and connect it with the developer App in the developer portal</div>
<div class="line">3. Enable App permissions (<em>Read</em> and <em>Write</em>)</div>
<div class="line">4. Navigate to the <strong>‘Keys and token’</strong> page, save your API key, API secret, Access token and Access secret</div>
</div>
<p><strong>Code example</strong></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tweepy</span>

<span class="c1"># do not share the API key in any public platform (e.g github, public website)</span>
<span class="n">consumer_key</span> <span class="o">=</span> <span class="n">API</span> <span class="n">secret</span>
<span class="n">consumer_secret</span> <span class="o">=</span> <span class="n">API</span> <span class="n">secret</span>
<span class="n">access_token</span> <span class="o">=</span> <span class="n">Access</span> <span class="n">token</span>
<span class="n">access_token_secret</span> <span class="o">=</span> <span class="n">Access</span> <span class="n">secret</span>


<span class="c1"># authorisation of consumer key and consumer secret</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">)</span>
<span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">access_token_secret</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span> <span class="n">wait_on_rate_limit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wait_on_rate_limit_notify</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Access the relevant tweets using the Twitter API</strong></p>
<div class="line-block">
<div class="line">There are different types of API provided by Twitter with various limitations. Please visit this link for further
information: <a class="reference external" href="https://developer.twitter.com/en/docs/twitter-api">https://developer.twitter.com/en/docs/twitter-api</a> .In the following section, you will learn how to
retrieve tweets from the Twitter timeline, hashtag/cashtag and also stream data that contains real time tweets.</div>
</div>
<div class="section" id="timeline-tweets">
<h3>Timeline tweets<a class="headerlink" href="#timeline-tweets" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Returns the 20 most recent tweets posted from the authenticated user. It is also possible to request another
user’s timeline via the the <code class="code docutils literal notranslate"><span class="pre">id</span></code> parameter.</div>
</div>
<div class="line-block">
<div class="line">Pass the <code class="code docutils literal notranslate"><span class="pre">user_id</span></code> or <code class="code docutils literal notranslate"><span class="pre">screen_name</span></code> parameters to access the user-specified tweets. For more information regarding the parameters,
please visit the official documentation: <a class="reference external" href="https://docs.tweepy.org/en/v3.5.0/api.html">https://docs.tweepy.org/en/v3.5.0/api.html</a></div>
</div>
<p><strong>Code example</strong></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create an empty list</span>
<span class="n">alltweets</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># extract data from the API</span>
<span class="n">timeline</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">user_timeline</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">userid</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">number_of_tweets</span><span class="p">)</span>
<span class="n">alltweets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">timeline</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_tweets.csv&#39;</span> <span class="o">%</span> <span class="n">screen_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">alltweets</span><span class="p">:</span>
         <span class="n">tweet_text</span> <span class="o">=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
         <span class="n">dates</span><span class="o">=</span><span class="n">tweet</span><span class="o">.</span><span class="n">created_at</span>
         <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">dates</span><span class="p">,</span><span class="n">tweet_text</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="hashtag-cashtag-tweets">
<h3>Hashtag/Cashtag tweets<a class="headerlink" href="#hashtag-cashtag-tweets" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Cashtag</strong> is a feature on Twitter that allows users retrieve tweets relevant to a particular ticker, say $GOOG, $AAPL or $FB.
Use <code class="code docutils literal notranslate"><span class="pre">tweepy.Cursor()</span></code> to access data from hashtag and cashtags.</div>
</div>
<p><strong>Code example</strong></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract data from the API</span>
<span class="n">hashtags</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">tweet_mode</span><span class="o">=</span><span class="s1">&#39;extended&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_tweets.csv&#39;</span> <span class="o">%</span> <span class="n">screen_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">hashtags</span><span class="p">:</span>
         <span class="n">tweet_text</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">full_text</span>
         <span class="n">dates</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">created_at</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
         <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">dates</span><span class="p">,</span><span class="n">tweet_text</span><span class="p">])</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">If you want to collect tweets for a period of time, we could further amend the code snippet in the following way:</div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_tweets.csv&#39;</span> <span class="o">%</span> <span class="n">screen_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">hashtags</span><span class="p">:</span>
        <span class="c1"># Add this line</span>
        <span class="o">**</span> <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">status</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;=</span> <span class="n">day_required</span><span class="p">:</span> <span class="o">**</span>
             <span class="n">tweet_text</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">full_text</span>
             <span class="n">dates</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">created_at</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
             <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">dates</span><span class="p">,</span><span class="n">tweet_text</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="stream-tweets">
<h3>Stream tweets<a class="headerlink" href="#stream-tweets" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The Twitter streaming API is used to download the tweets in real time. It is useful for obtaining a high volume of
tweets, or for creating a live feed using a site stream. For more information with the API, please visit this link:
<a class="reference external" href="https://docs.tweepy.org/en/v3.5.0/streaming_how_to.html">https://docs.tweepy.org/en/v3.5.0/streaming_how_to.html</a>.</div>
</div>
<ol class="arabic simple">
<li><p>Create a class inheriting from StreamListener</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># override tweepy.StreamListener</span>
<span class="k">class</span> <span class="nc">MyStreamListener</span><span class="p">(</span><span class="n">tweepy</span><span class="o">.</span><span class="n">StreamListener</span><span class="p">):</span>
    <span class="c1"># add logic to the on_staus method</span>
    <span class="k">def</span> <span class="nf">on_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tweet_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_tweets</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="c1"># collect tweets</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tweet_text</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">text</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">status</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span><span class="n">status</span><span class="o">.</span><span class="n">extended_tweet</span><span class="p">[</span><span class="s1">&#39;full_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tweet_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># add logic to the initialisation function</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span><span class="n">input_name</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyStreamListener</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_tweets</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tweet_count</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_name</span> <span class="o">=</span> <span class="n">input_name</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create a stream</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># add an output_file parameter to store the output tweets</span>
<span class="n">myStreamListener</span> <span class="o">=</span> <span class="n">MyStreamListener</span><span class="p">(</span><span class="n">output_file</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">input_name</span><span class="o">=</span><span class="n">firm</span><span class="p">)</span>
<span class="n">myStream</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">api</span><span class="o">.</span><span class="n">auth</span><span class="p">,</span> <span class="n">tweet_mode</span><span class="o">=</span><span class="s1">&#39;extended&#39;</span><span class="p">,</span> <span class="n">listener</span><span class="o">=</span><span class="n">myStreamListener</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;en&quot;</span><span class="p">])</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Start a stream</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">myStream</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">track</span><span class="o">=</span><span class="n">target_firm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="collect-financial-headlines">
<h2>Collect financial headlines<a class="headerlink" href="#collect-financial-headlines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="us-news-headlines">
<h3>US news headlines<a class="headerlink" href="#us-news-headlines" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><a class="reference external" href="https://finviz.com/">Finviz.com</a> is a browser-based stock market research platform that allows visitors
to read the latest financial news collected from different major newsagents such as Yahoo! Finance, Accesswire, and Newsfile.</div>
</div>
<div class="line-block">
<div class="line">Before the tutorial, it is important to take a look at the front-end code of the website.</div>
</div>
<img alt="&quot;AAPL finviz.com example&quot;" class="align-center" src="_images/apple_finviz_example.png" style="width: 400px; height: 252px;" />
<ol class="arabic simple">
<li><p>Access the website of each ticker through the <code class="code docutils literal notranslate"><span class="pre">urllib.request</span></code> module</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">allnews</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">finviz_url</span> <span class="o">=</span> <span class="s1">&#39;https://finviz.com/quote.ashx?t=&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">finviz_url</span> <span class="o">+</span> <span class="n">ticker</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user-agent&#39;</span><span class="p">:</span> <span class="s1">&#39;my-app/0.0.1&#39;</span><span class="p">})</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Get the HTML document using Beautiful Soup</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">html</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s2">&quot;lxml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Get the information of &lt;div&gt; id=’news-table’ in the website</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">news_table</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;news-table&#39;</span><span class="p">)</span>
<span class="n">news_tables</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span> <span class="o">=</span> <span class="n">news_table</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Find all the news under the &lt;tr&gt; tag in the news-table</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
    <span class="n">date_scrape</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">td</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date_scrape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">date_scrape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">date_scrape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">date_scrape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">news_time_st</span> <span class="n">r</span><span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">time</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Convert the date format to ‘YYYY-MM-dd’</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">date_time_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">news_time_str</span><span class="p">,</span> <span class="s1">&#39;%b-</span><span class="si">%d</span><span class="s1">-%y %I:%M%p&#39;</span><span class="p">)</span>
<span class="n">date_time</span><span class="o">=</span><span class="n">date_time_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Append all the news together</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">allnews</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">date_time</span><span class="p">,</span><span class="n">text</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="hk-news-headlines">
<h3>HK news headlines<a class="headerlink" href="#hk-news-headlines" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">We will also learn how to collect news headlines from <a class="reference external" href="aastock.com">aastock.com</a>. The website
one of the most popular financial information platforms in Hong Kong. It offers real-time international information
relevant to Hong Kong shares, which are useful for analysing sentiment and trends in the local market.</div>
</div>
<div class="line-block">
<div class="line">Again, before writing code to scrape the news, we need to have a look of the front-end code of the website. Take tencent (00700.HK) as an example.
Click ‘inspect’ and you can view the front-end code of the website. (Or visit this link: <a class="reference external" href="http://www.aastocks.com/en/stocks/analysis/stock-aafn/00700/0/all/1">http://www.aastocks.com/en/stocks/analysis/stock-aafn/00700/0/all/1</a>)</div>
</div>
<img alt="&quot;Tencent aastock.com example&quot;" class="align-center" src="_images/tencent_aastock_example.png" style="width: 540px; height: 182px;" />
<div class="line-block">
<div class="line">From the above snippet, we could know that the <code class="code docutils literal notranslate"><span class="pre">date'</span></code> attribute is stored within the <code class="code docutils literal notranslate"><span class="pre">&lt;div</span> <span class="pre">class</span> <span class="pre">='inline_block&gt;</span></code> under the
<code class="code docutils literal notranslate"><span class="pre">&lt;div</span> <span class="pre">class='newstime</span> <span class="pre">4'&gt;</span></code>, while the news headlines are stored within the <code class="code docutils literal notranslate"><span class="pre">&lt;div</span> <span class="pre">class='newscontent4</span> <span class="pre">mar8T'&gt;</span></code>.</div>
</div>
<div class="line-block">
<div class="line">The following steps are similar to that for collecting US news headlines.</div>
</div>
<ol class="arabic simple">
<li><p>Access the website of each ticker through <code class="code docutils literal notranslate"><span class="pre">urllib.request</span></code> module</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">prefix_url</span> <span class="o">=</span> <span class="s1">&#39;http://www.aastocks.com/en/stocks/analysis/stock-aafn/&#39;</span>
<span class="n">postfix_url</span> <span class="o">=</span> <span class="s1">&#39;/0/all/1&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">prefix_url</span> <span class="o">+</span> <span class="n">fill_ticker</span> <span class="o">+</span> <span class="n">postfix_url</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user-agent&#39;</span><span class="p">:</span> <span class="s1">&#39;my-app/0.0.1&#39;</span><span class="p">})</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Get the HTML document using Beautiful Soup</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">html</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s2">&quot;lxml&quot;</span><span class="p">)</span>

<span class="c1"># get the html code containing the dates and news</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;inline_block&quot;</span><span class="p">})</span>
<span class="n">news</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;newshead4&quot;</span><span class="p">})</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Find all the news and corresponding dates from the html code from step 2</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># track the index in the news list</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_tweets.csv&#39;</span> <span class="o">%</span> <span class="n">screen_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
        <span class="c1"># as the dates are in yyyy/mm/dd format</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">get_text</span><span class="p">()):</span>
            <span class="n">date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="c1"># the front-end code is not standardised and sometimes contains &#39;Release Time&#39; string</span>
            <span class="k">if</span> <span class="s2">&quot;Release Time&quot;</span> <span class="ow">in</span> <span class="n">date</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="mi">23</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">news</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">date_time_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># standardise the date format as &#39;YYYY-mm-dd&#39;</span>
            <span class="n">date_time</span> <span class="o">=</span> <span class="n">date_time_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># set the number of days you want to collect</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">date_time_obj</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;=</span> <span class="n">day_required</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">date_time</span><span class="p">,</span><span class="n">text</span><span class="p">])</span>
                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="vader-sentiment-prediction">
<h2>VADER sentiment prediction<a class="headerlink" href="#vader-sentiment-prediction" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">After the collection of data, it is time for you to now carry out the analysis with the database.</div>
</div>
<div class="line-block">
<div class="line">VADER (Valence Aware Dictionary for Sentiment Reasoning) is a model used for text sentiment analysis that is
sensitive to both polarity (positive/negative) and intensity (strength) of emotion. It is available in the NLTK
package and can be applied directly to unlabelled text data.</div>
</div>
<div class="line-block">
<div class="line">The sentiment labels are generated from the VADER Compound score according to the following rules:</div>
</div>
<ul class="simple">
<li><p>Positive sentiment (= 2): compound score &gt; 0.01</p></li>
<li><p>Neutral sentiment (= 1): −0.01 ≥ compound score ≤ 0.01</p></li>
<li><p>Negative sentiment (= 0): compound score &lt; −0.01</p></li>
</ul>
<div class="line-block">
<div class="line">Note that 1% was set as the threshold value accounting for the average stock movement in the US market, feel free to set
any value for your own analysis</div>
</div>
<ol class="arabic simple">
<li><p>Import these libraries</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.sentiment.vader</span> <span class="kn">import</span> <span class="n">SentimentIntensityAnalyzer</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">twitter_samples</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>VADER’s <code class="code docutils literal notranslate"><span class="pre">SentimentIntensityAnalyzer()</span></code> takes in a string and returns a dictionary of scores in each of four categories:</p></li>
</ol>
<ul class="simple">
<li><p>negative</p></li>
<li><p>neutral</p></li>
<li><p>positive</p></li>
<li><p>compound (computed by normalising the scores above, ranging from -1 to 1)</p></li>
</ul>
<p>Let us analyse the data that we have collected through the sentimental analyser.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pass in the path where you stored the csv file containing the data</span>
<span class="k">def</span> <span class="nf">read_tweets_us_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="c1"># could change to your own path</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span><span class="s1">&#39;train-data/&#39;</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>
    <span class="c1"># read in data as pandas dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analyzer</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;tweets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">])[</span><span class="s1">&#39;compound&#39;</span><span class="p">])</span>

    <span class="c1"># create a new column for the calculated results</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;compound_vader_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cs</span>
    <span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Label the sentiment for each tweet</p></li>
</ol>
<p>Parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">grouped_data</span></code>: consolidated data with features including (dates, tweets, compound_vader_score)</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">file_name</span></code>: the output name after the label function</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">perc_change</span></code>: the threshold value for labelling the sentiment</p></li>
</ul>
</div></blockquote>
<p>Code example</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_tweets_pred_label</span><span class="p">(</span><span class="n">grouped_data</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">perc_change</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;find_pred_label&#39;</span><span class="p">)</span>
    <span class="n">tweets</span> <span class="o">=</span> <span class="n">grouped_data</span><span class="p">[</span><span class="s1">&#39;tweets&#39;</span><span class="p">]</span>

<span class="c1"># group the tweets within the csv using [&#39;dates&#39;,&#39;ticker&#39;] index,</span>
<span class="n">grouped_data</span> <span class="o">=</span> <span class="n">grouped_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dates&#39;</span><span class="p">,</span><span class="s1">&#39;ticker&#39;</span><span class="p">])[</span><span class="s1">&#39;compound_vader_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">final_label</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grouped_data</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">grouped_data</span><span class="p">[</span><span class="s1">&#39;compound_vader_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">perc_change</span><span class="p">:</span>
        <span class="n">final_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">grouped_data</span><span class="p">[</span><span class="s1">&#39;compound_vader_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">perc_change</span><span class="p">:</span>
        <span class="n">final_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">grouped_data</span><span class="p">[</span><span class="s1">&#39;compound_vader_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">perc_change</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">grouped_data</span><span class="p">[</span><span class="s1">&#39;compound_vader_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">perc_change</span><span class="p">)):</span>
        <span class="n">final_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># add the column of vader_label</span>
<span class="n">grouped_data</span><span class="p">[</span><span class="s1">&#39;vader_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_label</span>
<span class="n">grouped_data</span><span class="p">[</span><span class="s1">&#39;tweets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tweets</span>

<span class="n">grouped_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">4. Merge all the data together</div>
</div>
<ul class="simple">
<li><p>actual label (= 2): price movement ≥ 0.01</p></li>
<li><p>actual label (= 1):  −0.01 ≥ price movement ≤ 0.01</p></li>
<li><p>actual label (= 0): price movement ≤ −0.01</p></li>
</ul>
<div class="line-block">
<div class="line">Parameters:</div>
</div>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">file_name</span></code>: consolidated data with features including (dates,tweets,compound_vader_score)</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">label_data</span></code>: the label data contains the actual label from yahoo finance</p></li>
</ul>
<p><strong>Code example</strong></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge_actual_label</span> <span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="n">label_data</span><span class="p">):</span>

    <span class="n">vader_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">vader_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dates&quot;</span><span class="p">,</span><span class="s2">&quot;ticker&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">label_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">label_data</span><span class="p">)</span>
    <span class="n">label_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dates&quot;</span><span class="p">,</span><span class="s2">&quot;ticker&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># merge the actual label and the predicted label into a single pandas data frame</span>
    <span class="n">merge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">vader_data</span><span class="p">,</span><span class="n">label_data</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">merge</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Unnamed: 0_y&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">merge</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">5. Validation using confusion matrix</div>
</div>
<p>Parameters:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">df</span></code>: the final merged pandas dataframe</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">name</span></code>: the output csv file containing all the merged information with dates, tweets, vader label and actual label</p></li>
</ul>
<p><strong>Code illustration</strong></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">validation</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="n">pred_label</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;vader_label&#39;</span><span class="p">])</span>
    <span class="n">actual_label</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">actual_label</span><span class="p">,</span> <span class="n">pred_label</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;True Neg&#39;</span><span class="p">,</span><span class="s1">&#39;False Pos&#39;</span><span class="p">,</span><span class="s1">&#39;False Neg&#39;</span><span class="p">,</span><span class="s1">&#39;True Pos&#39;</span><span class="p">]</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Negative&#39;</span><span class="p">,</span><span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="s1">&#39;Positive&#39;</span><span class="p">]</span>

    <span class="n">make_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">group_names</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">)</span>

    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<div class="line-block">
<div class="line">All investments entail inherent risk. This repository seeks to solely educate
people on methodologies to build and evaluate algorithmic trading strategies.
All final investment decisions are yours and as a result you could make or lose money.
All final investment decisions are yours and as a result you could make or lose money.</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="multi-feature-strategy.html" class="btn btn-neutral float-right" title="Multi-feature trading strategy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="property-price-prediction.html" class="btn btn-neutral float-left" title="Property price prediction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Angel Woo

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>