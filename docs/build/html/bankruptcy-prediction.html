

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bankruptcy prediction &mdash; algotrading 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Property price prediction" href="property-price-prediction.html" />
    <link rel="prev" title="Write a technical strategy" href="julia-technical-analysis.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> algotrading
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="how-to-use-this.html">How to use this</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Part 1: Intro to Algo Trading</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-science-basics.html">Data science basics</a></li>
</ul>
<p class="caption"><span class="caption-text">Part 2: Core trading strategies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="technical-analysis.html">Technical analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamental-analysis.html">Fundamental analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="evaluation-metrics.html">Evaluation metrics</a></li>
</ul>
<p class="caption"><span class="caption-text">Bonus: Julia for algo trading</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction-to-julia.html">Introduction to Julia</a></li>
<li class="toctree-l1"><a class="reference internal" href="julia-data-science-basics.html">Data science basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="julia-technical-analysis.html">Write a technical strategy</a></li>
</ul>
<p class="caption"><span class="caption-text">Part 3: Machine Learning</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Bankruptcy prediction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro-to-bankruptcy-prediction">Intro to bankruptcy prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bankruptcy-prediction-with-machine-learning">Bankruptcy prediction with machine learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-collection">Data collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#train-test-split">Train-test split</a></li>
<li class="toctree-l3"><a class="reference internal" href="#training-the-model">Training the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#evaluate-accuracy">Evaluate accuracy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inferencing">Inferencing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="property-price-prediction.html">Property price prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="sentiment-analysis.html">Sentiment analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrated-strategy.html">Integrated trading strategy</a></li>
</ul>
<p class="caption"><span class="caption-text">Bonus: Trade execution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="paper-trading.html">Paper Trading with Interactive Brokers</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="acknowledgement.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="about-the-author.html">About the author</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">algotrading</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Bankruptcy prediction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/bankruptcy-prediction.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bankruptcy-prediction">
<h1>Bankruptcy prediction<a class="headerlink" href="#bankruptcy-prediction" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, you will learn to:</p>
<ul class="simple">
<li><p>Train a machine learning model for bankruptcy prediction</p></li>
<li><p>Carry out inferencing</p></li>
<li><p>Screen out stocks based on the results</p></li>
</ul>
<div class="section" id="intro-to-bankruptcy-prediction">
<h2>Intro to bankruptcy prediction<a class="headerlink" href="#intro-to-bankruptcy-prediction" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">In this problem setting, we assume that the bankruptcy of a company could be
predicted several years ahead. We presume that certain financial ratios are
significant for the prediction of bankruptcy, and that we would compute these
ratios using the fundamentals data we have collected and train a machine learning
model to guess if a company would go bankrupt in one year based on these financial
ratios.</div>
</div>
</div>
<div class="section" id="bankruptcy-prediction-with-machine-learning">
<h2>Bankruptcy prediction with machine learning<a class="headerlink" href="#bankruptcy-prediction-with-machine-learning" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">The workflow of the prediction model is outlined as follows:</div>
</div>
<ol class="arabic simple">
<li><p>Collect labelled data (bankrupted = 0, survived = 1)</p></li>
<li><p>Split the dataset into training set and test set a ratio of 7:3</p></li>
<li><p>Train the machine learning model(s) with the labelled data (training set)</p></li>
<li><p>Evaluate the accuracy of the training model with the test set</p></li>
<li><p>Make use of the models to predict our own set of data (i.e. inferencing)</p></li>
</ol>
<div class="line-block">
<div class="line">We will go through these steps one by one, and try to predict the bankruptcy of a set of
companies in Hong Kong.</div>
</div>
<div class="section" id="data-collection">
<h3>Data collection<a class="headerlink" href="#data-collection" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The labelled dataset featured in the repository is collected by the <a class="reference external" href="https://lopucki.law.ucla.edu/">UCLA School of Law</a>.
It contains a total of about 200 records, which includes the fundamentals data of public companies in US as well as its
bankruptcy status (bankrupted = 0, survived = 1). Note that in the suffix of the dataset file names,
<code class="code docutils literal notranslate"><span class="pre">t1</span></code> means 1 year, <code class="code docutils literal notranslate"><span class="pre">t2</span></code> means 2 years, and so on.</div>
</div>
<div class="line-block">
<div class="line">Based on the training data and other references <a class="footnote-reference brackets" href="#id2" id="id1">1</a>, the below ratios have been selected as input variables for the machine learning model:</div>
</div>
<div class="math notranslate nohighlight">
\[\begin{split}X_1 &amp;= \text{Working capital } / \text{ Total assets} \\
X_2 &amp;= \text{Retained earnings } / \text{ Total assets} \\
X_3 &amp;= \text{EBIT } / \text{ Total assets} \\
X_4 &amp;= \text{Total equity (book) } / \text{ Total assets} \\
X_5 &amp;= \text{Net income } / \text{ Total assets} \\
X_6 &amp;= \text{Total liabilities } / \text{ Total assets} \\\end{split}\]</div>
<div class="line-block">
<div class="line">The code snippet for concatenating the dataset and creating the variables as shown below:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Concatenate data</span>
<span class="n">data_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">bankrupt_data</span><span class="p">,</span> <span class="n">non_bankrupt_data</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Add and scale variables</span>
<span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;X1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;WoCap&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;ToAsset&quot;</span><span class="p">])</span>
<span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;X2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;CFOper&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;ToLia&quot;</span><span class="p">])</span>
<span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;X3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;EBIT&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;ToAsset&quot;</span><span class="p">])</span>
<span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;X4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;ToEqui&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;ToAsset&quot;</span><span class="p">])</span>
<span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;X5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;NetInc&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;ToAsset&quot;</span><span class="p">])</span>
<span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;X6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;ToLia&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_full</span><span class="p">[</span><span class="s2">&quot;ToAsset&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="train-test-split">
<h3>Train-test split<a class="headerlink" href="#train-test-split" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The dataset is then split into training set and test set (with a ratio of 7:3),
so that we could achieve unbiased evaluation (i.e. the model is evaluated with fresh data).</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split data for training and testing</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[[</span><span class="s2">&quot;X1&quot;</span><span class="p">,</span> <span class="s2">&quot;X2&quot;</span><span class="p">,</span> <span class="s2">&quot;X3&quot;</span><span class="p">,</span> <span class="s2">&quot;X4&quot;</span><span class="p">,</span><span class="s2">&quot;X5&quot;</span><span class="p">,</span><span class="s2">&quot;X6&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span>
<span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">In the example, three machine learning models typically used for classification have been chosen:</div>
</div>
<ol class="arabic simple">
<li><p>Support Vector Machine</p></li>
<li><p>Decision Tree</p></li>
<li><p>Random Forest</p></li>
<li><p>K-Nearest Neighbor (KNN)</p></li>
</ol>
<div class="line-block">
<div class="line">They are defined as methods of the bankruptcy prediction model class in the example file. Thus,
it would be easier for us to compare and evaluate the performance of different machine learning
models.</div>
</div>
</div>
<div class="section" id="training-the-model">
<h3>Training the model<a class="headerlink" href="#training-the-model" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># after loading and pre-processing the data</span>

<span class="c1"># create an instance of the class</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">bankrupt_prediction</span><span class="p">(</span><span class="n">bankrupt_t1</span><span class="p">,</span> <span class="n">non_bankrupt_t1</span><span class="p">,</span> <span class="n">input_df</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># train with knn</span>
<span class="n">t1_results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">knn</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="evaluate-accuracy">
<h3>Evaluate accuracy<a class="headerlink" href="#evaluate-accuracy" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">We can check the performance of the model by looking into the confusion matrix and classification
report:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ouput:</span>

  <span class="n">Confusion</span> <span class="n">Matrix</span> <span class="n">using</span> <span class="n">Decision</span> <span class="n">Tree</span><span class="p">:</span>

  <span class="p">[[</span><span class="mi">7</span> <span class="mi">2</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">2</span> <span class="mi">9</span><span class="p">]]</span>

  <span class="n">Classification</span> <span class="n">Report</span> <span class="n">using</span> <span class="n">Decision</span> <span class="n">Tree</span><span class="p">:</span>

                <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

            <span class="mi">0</span>       <span class="mf">0.78</span>      <span class="mf">0.78</span>      <span class="mf">0.78</span>         <span class="mi">9</span>
            <span class="mi">1</span>       <span class="mf">0.82</span>      <span class="mf">0.82</span>      <span class="mf">0.82</span>        <span class="mi">11</span>

     <span class="n">accuracy</span>                           <span class="mf">0.80</span>        <span class="mi">20</span>
    <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.80</span>      <span class="mf">0.80</span>      <span class="mf">0.80</span>        <span class="mi">20</span>
 <span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.80</span>      <span class="mf">0.80</span>      <span class="mf">0.80</span>        <span class="mi">20</span>
</pre></div>
</div>
</div>
<div class="section" id="inferencing">
<h3>Inferencing<a class="headerlink" href="#inferencing" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">To carry out prediction with our own dataset, simply set the boolean of <code class="code docutils literal notranslate"><span class="pre">inferencing</span></code> to <code class="code docutils literal notranslate"><span class="pre">True</span></code>
and call the method again.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">inferencing</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># set Inferencing as True</span>

<span class="n">t1_results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">knn</span><span class="p">()</span>

<span class="c1"># save results to a csv file</span>
<span class="n">t1_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./results/t1_results-knn.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s1">&#39;column_names&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">To check what are the companies that survived in 1 year, load the results csv file and
filter out companies with a label of <code class="code docutils literal notranslate"><span class="pre">1</span></code>.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_t1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./results/t1_results-knn.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_t1</span><span class="p">[</span><span class="s1">&#39;knn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># get the percentage of survival</span>
<span class="nb">len</span><span class="p">(</span><span class="n">df_t1</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_t1</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">And we could save the filtered list as another csv file.</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_t1</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">df_filtered</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;survived-t1.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s1">&#39;column_names&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Sources</strong></p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>SAF2002, <a class="reference external" href="https://ja.wikipedia.org/wiki/SAF2002">https://ja.wikipedia.org/wiki/SAF2002</a></p>
</dd>
</dl>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<div class="line-block">
<div class="line">All investments entail inherent risk. This repository seeks to solely educate
people on methodologies to build and evaluate algorithmic trading strategies.
All final investment decisions are yours and as a result you could make or lose money.</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="property-price-prediction.html" class="btn btn-neutral float-right" title="Property price prediction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="julia-technical-analysis.html" class="btn btn-neutral float-left" title="Write a technical strategy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Angel Woo

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>